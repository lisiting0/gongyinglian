<!DOCTYPE html>
<html>

	<head>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>订货单</title>
		<meta name="keywords" content="订单管理">
		<meta name="description" content="订单管理">

		<link rel="shortcut icon" href="favicon.ico">
		<link href="../../css/bootstrap.min.css" rel="stylesheet">
		<link href="../../css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
		<link href="../../css/plugins/bootstrap-editable/bootstrap-editable.css" rel="stylesheet">
		<link href="../../css/plugins/bootstrap-editable/bootstrap-editable-select2.css" rel="stylesheet" type="text/css" />
		<link href="../../css/font-awesome.min.css" rel="stylesheet">
		<link href="../../css/animate.min.css" rel="stylesheet">
		<link href="../../css/style.min.css" rel="stylesheet">
		<link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
		<link href="../../css/plugins/blueimp/css/blueimp-gallery.min.css" rel="stylesheet">

		<style type="text/css">
			.form-horizontal .editable {
				width: 70px;
			}
		</style>
	</head>

	<body class="pd15">
		<form class="form-horizontal m-t" id="signupForm">
			<div class="form-group">
				<label class="col-sm-2 control-label">供货单位</label>
				<div class="col-sm-3">
					<select id="delivery_unit" class="js-example-basic-single form-control" ltype="select" ligeruiid="delivery_unit">
						<option value="">请选择</option>
						<option value="HN-GZJT-001">广州集团</option>
						<option value="HN-GZBJ-0011">广州宝玑集团</option>
						<option value="HB-BJZH-003">北京钟华集团</option>
						<option value="HB-BJZH-004">北京摇摇乐集团</option>
					</select>
				</div>
				<label class="col-sm-2 control-label">订货单位</label>
				<div class="col-sm-3">
					<select id="order_unit" class="js-example-basic-single form-control" ltype="select" ligeruiid="order_unit">
						<option value="">请选择</option>
						<option value="HN-GZJT-001">鼎骏</option>
						<option value="HN-GZBJ-0011">优尚时品</option>
					</select>
				</div>
			</div>
			<div class="disabled-textbox">
				<div class="form-group">
					<label class="col-sm-2 control-label">地址</label>
					<div class="col-sm-3">
						<input name="supplier_unit_address" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}">
					</div>
					<label class="col-sm-2 control-label">地址</label>
					<div class="col-sm-3">
						<input name="ordering_unit_address" class="ui-textbox none" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">联系人</label>
					<div class="col-sm-3">
						<input name="supply_unit_contact" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}">
					</div>
					<label class="col-sm-2 control-label">联系人</label>
					<div class="col-sm-3">
						<input name="ordering_unit_contact" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">联系方式</label>
					<div class="col-sm-3">
						<input name="supply_unit_phone" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:100}">
					</div>
					<label class="col-sm-2 control-label">联系方式</label>
					<div class="col-sm-3">
						<input name="ordering_unit_phone" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:100}">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">传真</label>
					<div class="col-sm-3">
						<input name="supply_unit_fax" class="ui-textbox" type="text" ltype="text">
					</div>
					<label class="col-sm-2 control-label">传真</label>
					<div class="col-sm-3">
						<input name="ordering_unit_fax" class="ui-textbox" type="text" ltype="text">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">开户行</label>
					<div class="col-sm-3">
						<input name="supply_unit_bank" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}">
					</div>
					<label class="col-sm-2 control-label">收货地址</label>
					<div class="col-sm-3">
						<input name="ordering_unit_bank" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}" value="广东省广州市海珠区xx街道xx号">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">账号</label>
					<div class="col-sm-3">
						<input name="account_number" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17,creditcard:true}">
					</div>
					<label class="col-sm-2 control-label">下单日期</label>
					<div class="col-sm-3">
						<input name="order_date" id="order_date" class="laydate-icon form-control layer-date" type="text" autocomplete="off" ltype="text" validate="{required:true,maxlength:10}" value="2017-3-9">
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">纳税人登记号</label>
				<div class="col-sm-3">
					<input name="taxpayer_registration_number" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}">
				</div>
			</div>
			<div class="form-group" style="font-weight:bold;color: blue;">
				<label class="col-sm-2 control-label">订单号</label>
				<div class="col-sm-3">
					<input name="order_num" class="ui-textbox border-none" type="text" value="PO-YFDK0012" disabled="disabled">
				</div>
				<label class="col-sm-2 control-label">开具发票</label>
				<div class="col-sm-3">
					<input name="product_inspector" value="A类开票" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:17}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">结算方式</label>
				<div class="col-sm-3">
					<select id="agencySales" class="form-control" ltype="select" ligeruiid="agencySales">
						<option value="代销">代销</option>
						<option value="经销">经销</option>
					</select>
				</div>
				<label class="col-sm-2 control-label">定金</label>
				<div class="col-sm-3">
					<input name="earnest" class="ui-textbox" type="text" ltype="text" validate="{number:true}">
				</div>
			</div>
			<div>
				<div class="form-group">
					<label class="col-sm-2 control-label">结算渠道</label>
					<div class="col-sm-3">
						<select name="billing_channel">
							<option value="汇款">汇款</option>
							<option value="现金">现金</option>
						</select>
					</div>
					<label class="col-sm-2 control-label">结算货币</label>
					<div class="col-sm-3">
						<select name="settlementCurrency">
							<option value=" ">请选择</option>
							<option value="人民币">人民币（RMB）</option>
							<option value="美元">美元（USD）</option>
							<option value="德国马克">德国马克（DEM）</option>
							<option value="日元">日元（JPY）</option>
							<option value="瑞士法郎">瑞士法郎（CHF）</option>
							<option value="法国法郎">法国法郎（FRF）</option>
							<option value="意大利里拉">意大利里拉（ITL）</option>
							<option value="荷兰盾">荷兰盾（NLG）</option>
							<option value="比利时法郎">比利时法郎（BEU）</option>
							<option value="丹麦克朗">丹麦克朗（DKR）</option>
							<option value="瑞典克朗">瑞典克朗（SKR）</option>
							<option value="挪威克朗">挪威克朗（NKR）</option>
							<option value="奥地利先令">奥地利先令（ATS）</option>
							<option value="港币">港币（HKD）</option>
							<option value="加拿大元">加拿大元（CAD）</option>
							<option value="澳大利亚元">澳大利亚元（AUD）</option>
							<option value="新西兰元">新西兰元（NZD）</option>
							<option value="新加坡元">新加坡元（SGD）</option>
							<option value="欧元">欧元（EUR）</option>
							<option value="英镑">英镑（GBP）</option>
						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">货币汇率</label>
					<div class="col-sm-3">
						<input name="currency_exchange_rate" class="ui-textbox" type="text" ltype="text" validate="{number:true}">
					</div>
					<label class="col-sm-2 control-label">折扣</label>
					<div class="col-sm-3">
						<input name="discount" class="ui-textbox" type="text" ltype="text" validate="{number:true}">
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">总批次</label>
				<div class="col-sm-3">
					<input name="total_batch" class="ui-textbox" type="text" ltype="text" validate="{required:true,minlength:1,maxlength:10,digits:true}" value="2">
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">合同上传</label>
				<div class="col-sm-8">
					<input type="text" id="file_name" readonly="readonly" value="未选择任何文件" />
					<a href="javascript:void(0);" class="inputfile btn btn-default">
						选择文件
						<input type="file" id="file" name="document[file]">
					</a>
					<button class="btn btn-primary" type="button" onclick="contractUpload()">合同上传</button>
					<button class="btn btn-primary" type="button" onclick="contractDownload()">合同下载</button>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">采购清单</label>
				<div class="col-sm-8">
					<div id="toolbar" style="margin-top: 10px;">
						<div class="btn-group">
							<button type="button" class="btn btn-outline btn-default" onclick="addInfo('添加','../../template/common/Products_list_add.html');">
                                <i class="glyphicon glyphicon-plus" aria-hidden="true"></i> 添加
                            </button>
							<button type="button" class="btn btn-outline btn-default" onclick="delInfo();">
                                <i class="glyphicon glyphicon-trash" aria-hidden="true"></i> 删除
                            </button>
						</div>
					</div>
					<table id="productInfoTable"></table>
				</div>
			</div>
			<div class="form-group text-right hidden-panel">
				<div class="col-sm-10">
					<button class="btn btn-info " type="button" onclick="preview('预览订货单','order_for_goods_preview.html')"><i class="fa fa-paste"></i>&nbsp;预览订货单</button>
					<button class="btn btn-primary" type="submit" onclick="submitForm();">下单</button>
					<button class="btn btn-primary" type="submit" onclick="cancelLayer();">取消</button>
				</div>
			</div>

			<div class="audit-panel display-none">
				<div class="form-group">
					<label class="col-sm-2 control-label">审核</label>
					<div class="col-sm-10">
						<div class="radio i-checks">
							<label><input type="radio" checked="" value="是" name="specialOffer"></label>审核通过
							<label><input type="radio" value="否" name="specialOffer"></label>退回修改
						</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">审核意见</label>
					<div class="col-sm-10" style="padding: 1px 15px;">
						<textarea name="audit" placeholder="请输入审核意见" class="layui-textarea" style="min-width:79.5%;min-height: 100px;height: auto;line-height: 20px;padding: 6px 10px;resize: vertical;border: 1px solid #e5e6e7;"></textarea>
					</div>
				</div>
				<div class="form-group text-right">
					<div class="col-sm-10">
						<button class="btn btn-primary" type="button" onclick="audio();">保存</button>
						<button class="btn btn-primary" type="submit" onclick="cancelLayer();">取消</button>
					</div>
				</div>
			</div>
		</form>

		<!--显示图片层-->
		<div id="blueimp-gallery" class="blueimp-gallery">
			<div class="slides"></div>
			<h3 class="title"></h3>
			<a class="close">×</a>
		</div>

		<script src="../../js/jquery.min.js"></script>
		<script src="../../js/bootstrap.min.js"></script>
		<script src="../../js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
		<script src="../../js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
		<script src="../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
		<script src="../../js/plugins/bootstrap-editable/bootstrap-editable.js"></script>
		<script src="../../js/plugins/bootstrap-editable/bootstrap-table-editable.js"></script>
		<script src="../../js/plugins/bootstrap-editable/bootstrap-editable-select2.full.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/js.js"></script>
		<script src="../../js/ligerui.all.js"></script>
		<script src="../../js/plugins/validate/jquery.validate.min.js"></script>
		<script src="../../js/plugins/validate/messages_zh.min.js"></script>
		<script src="../../js/plugins/validate/jquery.metadata.js"></script>
		<script src="../../js/plugins/layer/layer.min.js"></script>
		<script src="../../js/plugins/iCheck/icheck.min.js"></script>
		<script src="../../js/plugins/layer/laydate/laydate.js"></script>
		<script src="../../js/plugins/blueimp/jquery.blueimp-gallery.min.js"></script>

		<script>
			var table = $("#productInfoTable");
			$(function() {
				$("#file").change(function() { // 当 id 为 file 的对象发生变化时
					$("#file_name").val($(this).val()); //将 #file 的值赋给 #file_name
				})

				initTable();

				$(".btn-default").addClass("btn-outline");

				new formValidate({
					formEle: '#signupForm'
				});

				if($.getUrlParam('id')) {
					//setData();
					$('.disabled-textbox .ui-textbox').attr('disabled', 'disabled').addClass("border-none");
					$('.disabled-textbox .layer-date').attr('disabled', 'disabled').addClass("border-none");
					if($.getUrlParam('state') == 'AUDIT') {
						$('.hidden-panel').addClass('display-none');
						$('.audit-panel').removeClass('display-none');
					}
					var delivery_unit_trigger = $("#delivery_unit").select2().val("HN-GZJT-001").trigger("change"); //获取selectid
					delivery_unit_trigger.change(); //告诉select2代码已经更新，需要重载  默认选择有值得第一个
					showSupplierUnitInfo();
					$("#delivery_unit").prop("disabled", true); //设置下拉框不可用

					var order_unit_trigger = $("#order_unit").select2().val("HN-GZJT-001").trigger("change"); //获取selectid
					order_unit_trigger.change(); //告诉select2代码已经更新，需要重载  默认选择有值得第一个  		
					showOrderUnitInfo();
					$("#order_unit").prop("disabled", true); //设置下拉框不可用

					table.bootstrapTable('append', [{
						id: 10001,
						code: '160M60LYXCL',
						name: '表芯',
						purchase_type: '鼎骏自购',
						size: '通码',
						color: '通色',
						image: 'watch1',
						recent_transaction_price: 7,
						purchase_price: 8,
						quantity: 50,
						apportioned_amount_before: 400,
						apportioned_amount_after: 0,
						remark: 'xx'
					}, {
						id: 10002,
						code: '002B38068M QQF-01',
						name: '表带',
						purchase_type: '鼎骏自购',
						size: '通码',
						color: '通色',
						image: 'watch1',
						recent_transaction_price: 7,
						purchase_price: 8,
						quantity: 50,
						apportioned_amount_before: 400,
						apportioned_amount_after: 0,
						remark: ''
					}]);

					//合计
					sum();
				} else {
					//$('input').val();
				}

				laydate({
					elem: "#order_date",
					format: "YYYY-MM-DD",
					min: laydate.now(),
					max: "2099-06-16",
					istime: true,
					istoday: false,
					choose: function(datas) {}
				});
				$('#order_date').val(laydate.now(0, 'YYYY-MM-DD'));

				$(".i-checks").iCheck({
					checkboxClass: "icheckbox_square-green",
					radioClass: "iradio_square-green",
				})

				$('#delivery_unit').select2().on('select2:select', function(event) {
					//获取产品的值，再根据产品编号获取订单编号
					var delivery_unit = $(this).val();
					if(!delivery_unit) {
						return;
					}
					showSupplierUnitInfo();
				});

				$('#order_unit').select2({}).on('select2:select', function(event) {
					//获取产品的值，再根据产品编号获取订单编号
					var order_unit = $(this).val();
					if(!order_unit) {
						return;
					}
					showOrderUnitInfo();
				});

				$('#selectMaterial').select2({
					tags: true
				}).on('select2:select', function(event) {});
			});

			function showSupplierUnitInfo() {
				$('input[name="supplier_unit_address"]').val('广东省惠州市惠城区xx街道xx号');
				$('input[name="supply_unit_contact"]').val('李小明');
				$('input[name="supply_unit_phone"]').val('13113369041');
				$('input[name="supply_unit_bank"]').val('惠州市惠城区xx街建设银行');
				$('input[name="account_number"]').val('6160654654564654');
				$('input[name="taxpayer_registration_number"]').val('1545646545646'); //纳锐人登记好
			}

			function showOrderUnitInfo() {
				$('input[name="ordering_unit_address"]').val('广东省广州市海珠区xx街道xx号');
				$('input[name="ordering_unit_contact"]').val('季童薇');
				$('input[name="ordering_unit_phone"]').val('13113209041');
			}

			//初始化采购物资信息
			function initTable() {
				table.bootstrapTable({
					search: true,
					showRefresh: true,
					showColumns: true,
					icons: {
						refresh: "glyphicon-repeat",
						columns: "glyphicon-list"
					},
					toolbar: "#toolbar",
					columns: [{
						align: 'center',
						checkbox: true
					}, {
						field: "id",
						title: "唯一编号",
						visible: false
					}, {
						field: "code",
						title: "商品代码/物料型号",
					}, {
						field: "name",
						title: "商品/物料名称"
					}, {
						field: "purchase_type",
						title: "采购类型"
					}, {
						title: '尺码',
						field: 'size',
						visible: false
					}, {
						title: '颜色',
						field: 'color',
						visible: false
					}, {
						title: '图片',
						field: 'image',
						visible: false,
						formatter: function(v) {
							return '<a href="../../simg/' + v + '.jpg" title="图片" data-gallery="" class="gallery-img"><img src="../../img/' + v + '.jpg"></a>';
						}
					}, {
						title: '最近交易价格',
						field: 'recent_transaction_price'
					}, {
						title: '单价',
						field: 'purchase_price'
					}, {
						title: '数量',
						field: 'quantity',
						formatter: function(value, row, index) {
							if(row.purchase_type == '工厂外购') {
								return 0;
							} else {
								if(value == undefined) {
									value = '';
								}
								return '<input name="quantity" class="ui-textbox input-width quantity" type="text" ltype="text" validate="{required:true,digits:true}" value="' + value + '" onchange="quantityChange(this);" onblur="setValue(this)">';
							}
						}
					}, {
						title: '金额',
						field: 'apportioned_amount_before',
						class: 'amount',
						formatter: function(value, row, index) {
							if(row.purchase_type == '工厂外购' || row.purchase_price == undefined || row.quantity == undefined) {
								value = 0;
							} else {
								value = row.purchase_price * row.quantity;
							}
							return value;
						}
					}, {
						title: '交货日期',
						field: 'delivery_date',
						formatter: function(value, row, index) {
							if(!value) {
								value = showCurrentDate();
							}
							return value;
						},
						editable: {
							type: 'date',
							title: '交货日期',
							validate: function(v) {
								if(!v) return '交货日期不能为空';
							}
						},
					}, {
						title: '延迟时间',
						field: 'delay',
						formatter: function(value, row, index) {
							if(!value) {
								value = showCurrentDate();
							}
							return value;
						},
						editable: {
							type: 'date',
							title: '交货日期',
							validate: function(v) {
								if(!v) return '交货日期不能为空';
							}
						},
					}, {
						title: '备注',
						field: 'remark',
						formatter: function(value, row, index) {
							if(row.purchase_type == '工厂外购') {
								return '';
							} else {
								if(value == undefined) {
									value = '';
								}
								return '<textarea name="remark" placeholder="请输入内容" class="layui-textarea remark">' + value + '</textarea>';
							}
						}
					}],
					onSearch: function() {
						sum();
					},
					onColumnSwitch: function(field, checked) {
						sum();
					},
					onEditableSave: function(field, row, oldValue, $el) {
						//更新行才能合计
						table.bootstrapTable('updateRow', {
							index: row.rowId,
							row: row
						});
						sum();
					}
				});
			}

			//重置值
			function setValue(obj) {
				//获得焦点时，如果值为默认值，则设置为空				
				$(obj).attr("value", $(obj).val());
			}

			//添加采购信息
			function addInfo(title, url, id, w, h) {
				//				layer.open({
				//					type: 2,
				//					close: true,
				//					maxmin: true,
				//					title: title,
				//					area: ['90%', '90%'],
				//					content: url+'?type=PRODUCT',
				//					end: function() {
				//						sum();
				//					}
				//				});
				table.bootstrapTable('append', [{
					id: 10001,
					code: '160M60LYXCL',
					name: '表芯',
					purchase_type: '鼎骏自购',
					size: '通码',
					color: '通色',
					image: 'watch1',
					recent_transaction_price: 7,
					purchase_price: 8,
					quantity: 50,
					apportioned_amount_before: 400,
					apportioned_amount_after: 0,
					remark: 'xx'
				}, {
					id: 10002,
					code: '002B38068M QQF-01',
					name: '表带',
					purchase_type: '鼎骏自购',
					size: '通码',
					color: '通色',
					image: 'watch1',
					recent_transaction_price: 7,
					purchase_price: 8,
					quantity: 50,
					apportioned_amount_before: 400,
					apportioned_amount_after: 0,
					remark: ''
				}]);

			}

			//删除采购物资信息
			function delInfo() {
				var ids = $.map(table.bootstrapTable('getSelections'), function(row) {
					return row.id;
				});
				if(ids.length >= 1) {
					layer.confirm('您真的确定要删除吗?', {
						icon: 3,
						btn: ['确定', '取消'] //按钮
					}, function(index) {
						for(var i = 0; i < ids.length; i++) {
							table.bootstrapTable('remove', {
								field: 'id',
								values: [parseInt(ids[i])]
							});
						}
						layer.close(index);
					}, function(index) {
						layer.close(index);
					});
					sum();
				} else {
					layer.alert("请选择一行删除!");
					return;
				}
			}

			function quantityChange(obj) {
				//获取单价的值
				var price = $(obj).closest('td').prev().text();
				var purchase_price = $(obj).closest('td').prev().find('input[name=purchase_price]').val();
				//获取数量的值
				var quantity = $(obj).val();
				var total_price;
				if(quantity != null || quantity != "undefined" || quantity != "") {
					if(price != "") {
						total_price = parseFloat(quantity * price);
					} else {
						total_price = parseFloat(quantity * purchase_price);
					}
					//分摊前金额
					$(obj).closest('td').next().text(total_price);
					sum();
				}
			}

			function sum() {
				var sumQuantity = 0;
				var sumAmount = 0;
				//数量合计
				$("#infoTable input[name='quantity']").each(function() {
					sumQuantity += +$(this).val();
				});
				//分摊前金额合计
				$("#infoTable td[class='amount']").each(function() {
					sumAmount += +$(this).text();
				});
				//先删除最后一行
				if($("#infoTable tr").hasClass('footer')) {
					$("#infoTable tr:last").remove();
				}
				var columns = $('table thead tr').find('th').size();
				var nextColumns = $('table thead tr').find('th.amount').nextAll().size();
				var colspan = parseInt(columns - 2 - nextColumns);
				var tr = '<tr class="footer"><td class="text-right" colspan="' + colspan + '">合计</td><td class="total_count">' + sumQuantity + '</td><td  colspan="' + (nextColumns + 1) + '">' + sumAmount + '元</td></tr>';
				$('#infoTable').append(tr);
			}

			function valid() {
				var form = liger.get("signupForm");
				alert(form.valid());
			}

			function getData() {
				var form = liger.get("signupForm");
				var data = form.getData();
				alert(JSON.stringify(data));
			}

			function setData() {
				$.ajax({
					url: USER_INFO.SITE_URL + '/tp5/public/index.php/Admin/Admin/getUser',
					data: {
						id: $.getUrlParam('id')
					},
					success: function(res) {
						res = $.parseJSON(res);
						var form = new liger.get("signupForm");
						/**data 为测试使用**/
						var data = [{
							id: 1,
							materials_number: '1',
							materials_name: 'xx',
							unit_price: '50',
							quantity: '20',
							total_price: '1000',
							remark: '含吊牌及机芯'
						}];
						res = data;
						form.setData(res);
					}
				})
			}

			function submitForm() {
				var form = liger.get("signupForm");
				if(!form.valid()) {
					return;
				}
				var data = {};
				$("input,select,textarea").each(function() {
					var name = $(this).attr("name");
					if(name && name.indexOf('ligerui') == -1) {
						data[name] = this.value;
					}
				});
				data.id = $.getUrlParam('id');

				//				$.ajax({
				//					type: 'post',
				//					url: USER_INFO.SITE_URL + '/tp5/public/index.php/Admin/Admin/setUser',
				//					data: data,
				//					success: function(res) {
				//						if(Number(res)) {
				//							parent.table.bootstrapTable('refresh');
				//							var index = parent.layer.getFrameIndex(window.name);
				//							parent.layer.close(index);
				//							
				//						}
				//					}
				//				})

				/*
				            parent.table.bootstrapTable('refresh');
				            var index = parent.layer.getFrameIndex(window.name);
				            parent.layer.close(index);*/
			}

			function preview(title, url, id, w, h) {
				var fulls = "left=0,screenX=0,top=0,screenY=0,scrollbars=1"; //定义弹出窗口的参数  
				if(window.screen) {
					var ah = screen.availHeight - 30;
					var aw = screen.availWidth - 10;
					fulls += ",height=" + ah;
					fulls += ",innerHeight=" + ah;
					fulls += ",width=" + aw;
					fulls += ",innerWidth=" + aw;
					fulls += ",resizable"
				} else {
					fulls += ",resizable"; // 对于不支持screen属性的浏览器，可以手工进行最大化。 manually  
				}
				window.open(url, title, fulls);
			}
		</script>
	</body>

</html>